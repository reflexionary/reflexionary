# ğŸŒŠ Tethys - Your AI Financial Co-Pilot

> **Powered by Memory Layer + Mathematical Intelligence**

Tethys is an intelligent financial co-pilot that combines the power of AI memory with advanced mathematical intelligence to provide personalized financial guidance, portfolio management, and goal planning.

## ğŸš€ Features

### ğŸ§  Memory Layer - Your Financial Elephant
- **Personalized Memory**: Remembers your financial goals, preferences, and history
- **Semantic Search**: Lightning-fast retrieval of relevant financial context
- **Continuous Learning**: Builds understanding of your financial personality over time
- **Privacy-First**: Your sensitive data stays private while enabling personalization

### ğŸ§® Mathematical Intelligence - Your Personal Quant Guru
- **Portfolio Optimization**: Advanced asset allocation using modern portfolio theory
- **Risk Assessment**: Comprehensive risk metrics including VaR, CVaR, and stress testing
- **Time Series Forecasting**: Multi-model predictions using TFT, N-BEATS, and LSTM
- **Anomaly Detection**: Intelligent detection of unusual financial patterns
- **Performance Analytics**: Deep portfolio performance analysis with 50+ metrics

### ğŸ¯ Goal Planning & Tracking
- **Smart Goal Setting**: AI-powered goal recommendations based on your profile
- **Progress Monitoring**: Real-time tracking with intelligent insights
- **Timeline Optimization**: Dynamic adjustment of savings strategies
- **Success Probability**: Predictive analysis of goal achievement likelihood

### ğŸ” Anomaly Detection & Alerts
- **Transaction Monitoring**: Real-time detection of unusual spending patterns
- **Portfolio Alerts**: Intelligent monitoring of portfolio performance anomalies
- **Risk Alerts**: Proactive identification of potential financial risks
- **Customizable Preferences**: Personalized alert thresholds and frequencies

### ğŸ“Š Comprehensive Analytics
- **Portfolio Performance**: 50+ financial metrics and ratios
- **Risk Analysis**: Multi-dimensional risk assessment
- **Goal Progress**: Visual tracking and predictive insights
- **Behavioral Analysis**: Understanding of financial patterns and preferences

## ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Tethys Core Layer                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŒŠ Tethys Core Integration                                â”‚
â”‚  â”œâ”€â”€ User Interaction Service                              â”‚
â”‚  â”œâ”€â”€ Portfolio Management Service                          â”‚
â”‚  â”œâ”€â”€ Goal Planning Service                                 â”‚
â”‚  â””â”€â”€ Anomaly Detection Service                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Memory Layer                             â”‚
â”‚  ğŸ§  Embedding Service (sentence-transformers)              â”‚
â”‚  ğŸ§  Vector Index (Annoy)                                   â”‚
â”‚  ğŸ§  Persistent Storage (Firebase Firestore)                â”‚
â”‚  ğŸ§  Memory Manager                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                Mathematical Intelligence                    â”‚
â”‚  ğŸ§® Portfolio Optimization (PyPortfolioOpt)               â”‚
â”‚  ğŸ§® Risk Analysis (VaR, CVaR, Stress Testing)             â”‚
â”‚  ğŸ§® Time Series Forecasting (TFT, N-BEATS, LSTM)          â”‚
â”‚  ğŸ§® Performance Analytics (quantstats)                     â”‚
â”‚  ğŸ§® Anomaly Detection (Isolation Forest)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   Data Connectors                          â”‚
â”‚  ğŸ“¡ Fi-MCP Connector (Financial Data)                     â”‚
â”‚  ğŸ“¡ Market Data Connector                                  â”‚
â”‚  ğŸ“¡ External API Connectors                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   Observability                            â”‚
â”‚  ğŸ“Š Structured Logging (JSON + Console)                   â”‚
â”‚  ğŸ“Š Metrics Collection (Prometheus Format)                 â”‚
â”‚  ğŸ“Š Performance Monitoring                                 â”‚
â”‚  ğŸ“Š Health Checks                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ Installation

### Prerequisites
- Python 3.9+
- Firebase project with Firestore
- Google Gemini API key
- Fi-MCP simulator (for financial data)

### Quick Start

1. **Clone the repository**
   ```bash
   git clone <repository-url>
   cd tethys
   ```

2. **Install dependencies**
   ```bash
   pip install -r requirements.txt
   ```

3. **Set up environment variables**
   ```bash
   export GEMINI_API_KEY="your-gemini-api-key"
   export FIREBASE_SERVICE_ACCOUNT_KEY_PATH="/path/to/firebase-key.json"
   export FI_MCP_SIMULATOR_BASE_URL="http://localhost:3000"
   ```

4. **Initialize Tethys**
   ```bash
   python main.py
   ```

## ğŸš€ Usage

### CLI Mode (Interactive)
```bash
python main.py --mode cli
```

**Available Commands:**
- `query <user_id> <query>` - Process a user query
- `dashboard <user_id>` - Get user dashboard
- `sync <user_id>` - Sync user data
- `status` - Show system status
- `help` - Show help
- `exit` - Exit Tethys

### API Mode
```bash
# Start the API server
uvicorn ml_ops.model_serving.serve_tethys_models:app --reload --host 0.0.0.0 --port 8000
```

**API Endpoints:**
- `POST /memory/ingest` - Ingest user memory
- `POST /memory/query` - Query user memories
- `POST /quant/portfolio/optimize` - Optimize portfolio
- `POST /quant/risk/var` - Calculate Value at Risk
- `POST /integrated/financial_advice` - Get integrated financial advice

### Testing
```bash
# Test with specific user and query
python main.py --mode cli --user-id test_user --query "How should I invest my money?"
```

## ğŸ“ Project Structure

```
tethys/
â”œâ”€â”€ core_components/           # Core infrastructure
â”‚   â”œâ”€â”€ embedding_service.py   # Text embedding generation
â”‚   â”œâ”€â”€ vector_index.py        # Vector search and indexing
â”‚   â””â”€â”€ persistent_storage.py  # Firebase Firestore integration
â”œâ”€â”€ memory_management/         # Memory Layer
â”‚   â”œâ”€â”€ memory_manager.py      # Memory orchestration
â”‚   â””â”€â”€ gemini_connector.py    # AI model integration
â”œâ”€â”€ financial_intelligence/    # Mathematical Intelligence
â”‚   â”œâ”€â”€ ml_quant_models/       # ML models (TFT, N-BEATS, LSTM)
â”‚   â”œâ”€â”€ portfolio_opt/         # Portfolio optimization
â”‚   â”œâ”€â”€ risk_analysis/         # Risk assessment
â”‚   â””â”€â”€ core_metrics/          # Performance analytics
â”œâ”€â”€ services/                  # Business services
â”‚   â”œâ”€â”€ anomaly_detection_service.py
â”‚   â”œâ”€â”€ portfolio_management_service.py
â”‚   â”œâ”€â”€ goal_planning_service.py
â”‚   â””â”€â”€ user_interaction_service.py
â”œâ”€â”€ data_connectors/           # Data integration
â”‚   â””â”€â”€ fi_mcp_connector.py    # Financial data connector
â”œâ”€â”€ observability/             # Monitoring and logging
â”‚   â”œâ”€â”€ logging_config.py      # Structured logging
â”‚   â””â”€â”€ metrics_exporter.py    # Metrics collection
â”œâ”€â”€ ml_ops/                    # MLOps pipeline
â”‚   â”œâ”€â”€ model_training/        # Model training scripts
â”‚   â””â”€â”€ model_serving/         # Model serving APIs
â”œâ”€â”€ config/                    # Configuration
â”‚   â””â”€â”€ app_settings.py        # Application settings
â”œâ”€â”€ tethys_core.py            # Main integration layer
â””â”€â”€ main.py                   # Application entry point
```

## ğŸ”§ Configuration

### Environment Variables
```bash
# Required
GEMINI_API_KEY=your-gemini-api-key
FIREBASE_SERVICE_ACCOUNT_KEY_PATH=/path/to/firebase-key.json

# Optional
FI_MCP_SIMULATOR_BASE_URL=http://localhost:3000
LOG_LEVEL=INFO
EMBEDDING_MODEL_NAME=all-MiniLM-L6-v2
ANOMALY_DETECTION_THRESHOLD=0.8
DEFAULT_RISK_FREE_RATE=0.05
```

### Feature Flags
```bash
FEATURE_MEMORY_LAYER=true
FEATURE_MATHEMATICAL_INTELLIGENCE=true
FEATURE_ANOMALY_DETECTION=true
FEATURE_GOAL_PLANNING=true
FEATURE_PORTFOLIO_OPTIMIZATION=true
```

## ğŸ“Š MLOps Pipeline

### Model Training
```bash
# Train memory models
python ml_ops/model_training/train_memory_models.py

# Train quantitative models
python ml_ops/model_training/train_quant_models.py

# Train anomaly detection
python ml_ops/model_training/train_anomaly_detector.py
```

### Model Serving
```bash
# Serve all models
uvicorn ml_ops.model_serving.serve_tethys_models:app --reload

# Serve specific model
uvicorn ml_ops.model_serving.serve_anomaly_detector:app --reload
```

## ğŸ” Monitoring & Observability

### Logging
- **Structured Logging**: JSON format for machine readability
- **Component-Specific**: Separate log files for each component
- **Performance Tracking**: Operation timing and metrics
- **Error Tracking**: Comprehensive error logging with context

### Metrics
- **Performance Metrics**: Response times, throughput, error rates
- **Business Metrics**: User activity, memory operations, financial calculations
- **System Metrics**: Health checks, component status, resource usage
- **Export Formats**: JSON and Prometheus formats

### Health Checks
```bash
# Check system status
curl http://localhost:8000/health

# Check model status
curl http://localhost:8000/models/status
```

## ğŸ›¡ï¸ Security & Privacy

### Data Privacy
- **PII Masking**: Automatic masking of sensitive information
- **Data Encryption**: End-to-end encryption of financial data
- **Audit Logging**: Comprehensive audit trails
- **Access Control**: Role-based access control

### Security Features
- **API Rate Limiting**: Protection against abuse
- **Input Validation**: Comprehensive input sanitization
- **Error Handling**: Secure error messages
- **Circuit Breakers**: Protection against cascading failures

## ğŸ§ª Testing

### Unit Tests
```bash
python -m pytest tests/unit/
```

### Integration Tests
```bash
python -m pytest tests/integration/
```

### Performance Tests
```bash
python -m pytest tests/performance/
```

## ğŸ“ˆ Performance

### Benchmarks
- **Memory Retrieval**: < 100ms for semantic search
- **Portfolio Optimization**: < 5s for complex portfolios
- **Anomaly Detection**: < 1s for real-time detection
- **API Response**: < 2s for complex queries

### Scalability
- **Memory Layer**: Supports 1M+ memories per user
- **Vector Search**: Sub-second retrieval from 10M+ vectors
- **API**: Handles 1000+ concurrent requests
- **Storage**: Efficient compression and indexing

## ğŸ¤ Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## ğŸ“„ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## ğŸ™ Acknowledgments

- **Google Gemini**: For AI model capabilities
- **Firebase**: For scalable data storage
- **PyPortfolioOpt**: For portfolio optimization
- **quantstats**: For financial analytics
- **sentence-transformers**: For semantic embeddings
- **Annoy**: For vector search

## ğŸ“ Support

- **Documentation**: [Wiki](link-to-wiki)
- **Issues**: [GitHub Issues](link-to-issues)
- **Discussions**: [GitHub Discussions](link-to-discussions)
- **Email**: support@tethys.ai

---

**ğŸŒŠ Tethys - Where Memory Meets Mathematics for Smarter Finance**
